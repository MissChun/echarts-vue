webpackJsonp([4],{SrFo:function(t,e){},tbjF:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("//Fk"),s=i.n(a),n={name:"standardOverview",data:function(){return{map:"",layer:"",pageLoading:"",resultsData:"",infoWin:"",tableDom:"",fluidList:[],fluidLayer:"",siteList:[],siteLayer:"",searchFilters:{fluid:"",site:""},fluidSelectList:[],siteSelectList:[],searchBtn:{loading:!1}}},methods:{getFluidAndSiteList:function(){var t=this;this.$$http("loadlist").then(function(e){e.data&&0==e.data.code&&(t.fluidSelectList=e.data.data.fluids,t.siteSelectList=e.data.data.stations)})},initMap:function(){var t=this;this.map=Loca.create("overview-container",{mapStyle:"amap://styles/midnight",zoom:4}),this.layer=Loca.visualLayer({eventSupport:!0,container:this.map,blendMode:"lighter",type:"line",shape:"line",fitView:!0}),this.fluidLayer=Loca.visualLayer({container:this.map,blendMode:"lighter",type:"point",shape:"circle"}),this.siteLayer=Loca.visualLayer({container:this.map,blendMode:"lighter",type:"point",shape:"circle"}),this.fluidLayer.setOptions({style:{radius:2,fill:"#0606f5",lineWidth:.5,stroke:"#0606f5",opacity:1}}),this.siteLayer.setOptions({style:{radius:1,fill:"#f90d4f",lineWidth:1,stroke:"#f90d4f",opacity:.8}}),this.layer.on("mousemove",function(e){var i=e.rawData,a=i.fluid_name+"-"+i.station_name,s=i.fluid_address,n=i.station_name,l=e.originalEvent;t.openInfoWin(t.map.getMap(),l,{"路线":a,"液厂位置":s,"站点位置":n})}),this.layer.on("mouseleave",function(e){t.closeInfoWin()}),this.layer.on("click",function(t){t.rawData}),this.layer.setOptions({style:{lineWidth:1,curveness:.2,stroke:"rgba(49, 80, 189, 0.3)"},selectStyle:{lineWidth:3,stroke:"rgba(49, 80, 189, 0.8)"}})},openInfoWin:function(t,e,i){this.infoWin||(this.infoWin=new AMap.InfoWindow({isCustom:!0,offset:new AMap.Pixel(130,100)}));var a=e.offsetX,s=e.offsetY,n=t.containerToLngLat(new AMap.Pixel(a,s));if(!this.tableDom){var l=document.createElement("div");l.className="overview-info",this.tableDom=document.createElement("table"),l.appendChild(this.tableDom),this.infoWin.setContent(l)}var r="";for(var o in i){r+='<tr><td style="color:#fff;font-size:14px;"> '+o+'</td><td>&nbsp;</td><td style="color:#fff;font-size:14px;">'+i[o]+"</td></tr>"}this.tableDom.innerHTML=r,this.infoWin.open(t,n)},closeInfoWin:function(){this.infoWin&&this.infoWin.close()},getData:function(){var t=this;return new s.a(function(e,i){t.pageLoading=!0,t.fluidList=[],t.siteList=[],t.$$http("loadAllTrip",{fluid_name:t.searchFilters.fluid,station_name:t.searchFilters.site}).then(function(i){t.resultsData=i.data.data,t.resultsData.length||t.$message.success("无路线"),t.resultsData=t.resultsData.map(function(e){return t.fluidList.push({line:e.coord.line[0]}),t.siteList.push({line:e.coord.line[1]}),e.coord}),e(i)}).catch(function(e){t.pageLoading=!1,i(e)})})},renderLayer:function(){this.layer.setData(this.resultsData,{lnglat:"line"}),this.fluidLayer.setData(this.fluidList,{lnglat:"line"}),this.siteLayer.setData(this.siteList,{lnglat:"line"}),this.searchFilters.fluid.length||this.searchFilters.site.length?this.layer.setOptions({style:{lineWidth:2,curveness:.2,stroke:"rgba(49, 80, 189, 0.3)"},selectStyle:{lineWidth:4,stroke:"rgba(49, 80, 189, 1)"}}):this.layer.setOptions({style:{lineWidth:1,curveness:.2,stroke:function(t){return t.value.distance<=500?"rgba(49, 80, 189, 0.3)":"rgba(235, 18, 18, 0.3)"}},selectStyle:{lineWidth:3,stroke:"rgba(49, 80, 189, 0.8)"}}),this.layer.render(),this.fluidLayer.render(),this.siteLayer.render()},startSearch:function(){var t=this;this.searchBtn.loading=!0,this.getData().then(function(){t.pageLoading=!1,t.renderLayer(),t.searchBtn.loading=!1})}},created:function(){var t=this;this.getFluidAndSiteList(),this.getData().then(function(){setTimeout(function(){t.pageLoading=!1,t.initMap(),t.renderLayer()},500)})}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"tab-screen overview"},[i("el-form",{staticClass:"search-filters-form",attrs:{"label-width":"80px",model:t.searchFilters,"status-icon":""}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"液厂:"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",clearable:"",placeholder:"请选择"},model:{value:t.searchFilters.fluid,callback:function(e){t.$set(t.searchFilters,"fluid",e)},expression:"searchFilters.fluid"}},t._l(t.fluidSelectList,function(t,e){return i("el-option",{key:e,attrs:{label:t,value:t}})}))],1)],1),t._v(" "),i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"站点:"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",clearable:"",placeholder:"请选择"},model:{value:t.searchFilters.site,callback:function(e){t.$set(t.searchFilters,"site",e)},expression:"searchFilters.site"}},t._l(t.siteSelectList,function(t,e){return i("el-option",{key:e,attrs:{label:t,value:t}})}))],1)],1),t._v(" "),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary",isDisabled:t.searchBtn.loading,isLoading:t.searchBtn.loading},on:{click:t.startSearch}},[t._v("搜索")])],1)],1)],1),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"map-loading"})],1),t._v(" "),i("div",{staticClass:"overview-container",attrs:{id:"overview-container"}})])},staticRenderFns:[]};var r=i("VU/8")(n,l,!1,function(t){i("SrFo")},"data-v-4733def6",null);e.default=r.exports}});
//# sourceMappingURL=4.5b956fad2328a280e2db.js.map